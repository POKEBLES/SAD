<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clustering (K-Means) - Waste Analytics</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header class="dashboard-header">
    <div class="header-logo">
      <img src="https://tse1.mm.bing.net/th/id/OIP.7FZwq6jY3y6N8DpbxpyIagHaHa?pid=Api&P=0&h=180" alt="Partner Logo" class="header-logo-img-alt">
      <h1>Manila Waste Analytics</h1>
    </div>
    <nav class="header-nav">
      <a href="index.html"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
      <a href="data-management.html"><i class="fa-solid fa-file-csv"></i> Data Management</a>
      <a href="forecasting.html"><i class="fa-solid fa-chart-line"></i> Forecasting</a>
      <a href="clustering.html" class="active"><i class="fa-solid fa-users-viewfinder"></i> Clustering</a>
      <a href="reports.html"><i class="fa-solid fa-file-lines"></i> Reports</a>
      <a href="feedback.html"><i class="fa-solid fa-bullhorn"></i> Feedback</a>
      <a href="admin-dashboard.html"><i class="fa-solid fa-shield"></i> Admin</a>
      <a href="user-management.html"><i class="fa-solid fa-users"></i> Users</a>
    </nav>
    <div class="header-profile">
      <i class="fa-solid fa-user-circle" id="user-profile-icon" style="cursor: pointer; transition: transform 0.2s;" title="Click to view profile"></i>
    </div>
  </header>

  <script>
    document.getElementById('user-profile-icon').addEventListener('click', function(){
      window.location.href = 'user-profile.html';
    });
  </script>

  <main class="dashboard-container">
    <div class="dashboard-card">
      <h3>Household Clusters Map</h3>
      <p class="muted">Clusters: High Waste Generators (red), Compliant Segregators (green), Non-Segregating (orange)</p>
      <div id="cluster-map" style="height:420px;border-radius:6px;border:1px solid #dde3ea"></div>
    </div>

    <div class="dashboard-card" style="margin-top:16px;">
      <h3>Cluster Statistics</h3>
      <div id="cluster-stats" style="display:flex;gap:12px;flex-wrap:wrap">
        <!-- stats cards populated by JS -->
      </div>
    </div>

    <div class="dashboard-card" style="margin-top:16px;">
      <h3>Interpretation for Planners</h3>
      <ul id="cluster-interpretation">
        <!-- interpretation bullets -->
      </ul>
    </div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const map = L.map('cluster-map').setView([14.5995,120.9842],12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

    // sample households with cluster id (0=High,1=Compliant,2=Non-seg)
    const households = [
      {id:1,lat:14.605,lon:120.98,cluster:0,volume:20},
      {id:2,lat:14.602,lon:120.99,cluster:1,volume:4},
      {id:3,lat:14.598,lon:120.98,cluster:2,volume:12},
      {id:4,lat:14.59,lon:120.985,cluster:0,volume:25},
      {id:5,lat:14.61,lon:120.978,cluster:1,volume:3},
      {id:6,lat:14.596,lon:120.99,cluster:2,volume:15}
    ];

    const clusterMeta = [
      {name:'High Waste Generators', color:'#A72703'},
      {name:'Compliant Segregators', color:'#84994F'},
      {name:'Non-Segregating Households', color:'#FCB53B'}
    ];

    const stats = [0,0,0];
    const sumVol = [0,0,0];

    households.forEach(h => {
      stats[h.cluster]++;
      sumVol[h.cluster] += h.volume;
      const circle = L.circle([h.lat,h.lon],{radius: Math.max(6,h.volume*2), color: clusterMeta[h.cluster].color, fillColor: clusterMeta[h.cluster].color, fillOpacity:0.6}).addTo(map);
      circle.bindPopup('<strong>Household '+h.id+'</strong><br/>Cluster: '+clusterMeta[h.cluster].name+'<br/>Volume: '+h.volume+' kg');
    });

    // populate stats
    const statsDiv = document.getElementById('cluster-stats');
    clusterMeta.forEach((c,i)=>{
      const avg = stats[i] ? (sumVol[i]/stats[i]).toFixed(1) : '0';
      const card = document.createElement('div'); card.className='dashboard-card'; card.style.minWidth='200px'; card.innerHTML = `
        <div style="font-size:0.9rem;color:#6c757d">${c.name}</div>
        <div style="font-weight:700;font-size:1.25rem">${stats[i]} households</div>
        <div style="color:#6c757d">Avg volume: ${avg} kg</div>
      `;
      statsDiv.appendChild(card);
    });

    // interpretation
    const interp = document.getElementById('cluster-interpretation');
    interp.innerHTML = '';
    interp.appendChild(Object.assign(document.createElement('li'),{textContent:'High Waste Generators: prioritize targeted collection and education; consider additional pickup.'}));
    interp.appendChild(Object.assign(document.createElement('li'),{textContent:'Compliant Segregators: maintain incentives and track for best practices.'}));
    interp.appendChild(Object.assign(document.createElement('li'),{textContent:'Non-Segregating Households: outreach, segmentation programs and monitoring.'}));

  });
  </script>
</body>
</html>