<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forecasting (ARIMA) - Waste Analytics</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="dashboard-header">
    <div class="header-logo">
      <img src="https://tse1.mm.bing.net/th/id/OIP.7FZwq6jY3y6N8DpbxpyIagHaHa?pid=Api&P=0&h=180" alt="Partner Logo" class="header-logo-img-alt">
      <h1>Manila Waste Analytics</h1>
    </div>
    <nav class="header-nav">
      <a href="index.html"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
      <a href="data-management.html"><i class="fa-solid fa-file-csv"></i> Data Management</a>
      <a href="forecasting.html" class="active"><i class="fa-solid fa-chart-line"></i> Forecasting</a>
      <a href="clustering.html"><i class="fa-solid fa-users-viewfinder"></i> Clustering</a>
      <a href="reports.html"><i class="fa-solid fa-file-lines"></i> Reports</a>
      <a href="feedback.html"><i class="fa-solid fa-bullhorn"></i> Feedback</a>
      <a href="admin-dashboard.html"><i class="fa-solid fa-shield"></i> Admin</a>
      <a href="user-management.html"><i class="fa-solid fa-users"></i> Users</a>
    </nav>
    <div class="header-profile">
      <i class="fa-solid fa-user-circle" id="user-profile-icon" style="cursor: pointer; transition: transform 0.2s;" title="Click to view profile"></i>
    </div>
  </header>

  <script>
    document.getElementById('user-profile-icon').addEventListener('click', function(){
      window.location.href = 'user-profile.html';
    });
  </script>

  <main class="dashboard-container">
    <div class="dashboard-card">
      <h3>Actual vs Forecasted Waste</h3>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
        <label>View:
          <select id="view-select">
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </label>

        <label>Filter Barangay:
          <select id="filter-barangay">
            <option value="">All</option>
            <option>Barangay 1</option>
            <option>Barangay 2</option>
            <option>Barangay 3</option>
          </select>
        </label>

        <div style="margin-left:auto;display:flex;gap:10px;">
          <div class="dashboard-card" style="padding:8px 12px;min-width:160px;">
            <div style="font-size:0.85rem;color:#6c757d">Forecast Accuracy (MAPE)</div>
            <div id="mape" style="font-weight:700;font-size:1.25rem">--</div>
          </div>
          <div class="dashboard-card" style="padding:8px 12px;min-width:160px;">
            <div style="font-size:0.85rem;color:#6c757d">RMSE</div>
            <div id="rmse" style="font-weight:700;font-size:1.25rem">--</div>
          </div>
          <div class="dashboard-card" style="padding:8px 12px;min-width:160px;">
            <div style="font-size:0.85rem;color:#6c757d">Next Week Prediction</div>
            <div id="next-week" style="font-weight:700;font-size:1.25rem">--</div>
          </div>
        </div>
      </div>

      <canvas id="forecastChart" height="120"></canvas>
    </div>

    <div class="dashboard-card" style="margin-top:16px;">
      <h3>Interpretation Summary</h3>
      <p id="interpretation">Simple model showing trends â€” use ARIMA training on historical dataset to refine.</p>
    </div>

  </main>

  <script>
    // Demo data and simple forecasting (not a true ARIMA implementation)
    (function(){
      const ctx = document.getElementById('forecastChart').getContext('2d');
      // sample historical (actual) weekly data
      let actualWeekly = [120,130,125,140,150,160,155,165,170,180,175,185];
      // simple forecast: take last value + small growth
      function simpleForecast(series, steps){
        const res = [];
        let last = series[series.length-1];
        for(let i=0;i<steps;i++){ last = Math.round(last * (1 + (Math.random()*0.03 + 0.005))); res.push(last); }
        return res;
      }

      function calcMAPE(actual, forecast){
        const n = Math.min(actual.length, forecast.length);
        let sum=0; for(let i=0;i<n;i++){ sum += Math.abs((actual[i]-forecast[i]) / (actual[i]||1)); }
        return (100 * sum / n).toFixed(1);
      }
      function calcRMSE(actual, forecast){
        const n = Math.min(actual.length, forecast.length);
        let sum=0; for(let i=0;i<n;i++){ const e = (actual[i]-forecast[i]); sum += e*e; }
        return Math.sqrt(sum/n).toFixed(2);
      }

      let forecastChart;
      function render(view){
        const labels = view === 'weekly' ? actualWeekly.map((_,i)=>'W'+(i+1)) : ['M1','M2','M3','M4','M5','M6','M7','M8','M9','M10','M11','M12'];
        const historical = actualWeekly.slice();
        const fc = simpleForecast(historical, 4);
        const combinedLabels = labels.concat(['P+1','P+2','P+3','P+4']);
        const forecastSeries = new Array(historical.length - 4).fill(null).concat(fc);

        const mape = calcMAPE(historical.slice(-4), fc);
        const rmse = calcRMSE(historical.slice(-4), fc);

        document.getElementById('mape').textContent = mape + '%';
        document.getElementById('rmse').textContent = rmse;
        document.getElementById('next-week').textContent = fc[0] + ' kg';

        const data = {
          labels: combinedLabels,
          datasets: [
            { label: 'Actual', data: historical.concat(new Array(4).fill(null)), borderColor: '#2c3e50', backgroundColor: 'rgba(44,62,80,0.05)', tension:0.2 },
            { label: 'Forecast', data: forecastSeries, borderColor: '#FCB53B', backgroundColor: 'rgba(252,181,59,0.12)', borderDash:[6,4], tension:0.2 }
          ]
        };
        if(forecastChart) forecastChart.destroy();
        forecastChart = new Chart(ctx, { type:'line', data, options:{ responsive:true, plugins:{legend:{position:'top'} } } });
      }

      document.getElementById('view-select').addEventListener('change', function(){ render(this.value); });
      document.getElementById('filter-barangay').addEventListener('change', function(){ /* in demo no real filtering */ render(document.getElementById('view-select').value); });

      render('weekly');
    })();
  </script>
</body>
</html>