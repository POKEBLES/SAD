<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Waste Data Management</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="dashboard-header">
    <div class="header-logo">
      <img src="https://tse1.mm.bing.net/th/id/OIP.7FZwq6jY3y6N8DpbxpyIagHaHa?pid=Api&P=0&h=180" alt="Partner Logo" class="header-logo-img-alt">
      <h1>Manila Waste Analytics</h1>
    </div>
    <nav class="header-nav">
  <a href="index.html"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
  <a href="data-management.html" class="active"><i class="fa-solid fa-file-csv"></i> Data Management</a>
  <a href="forecasting.html"><i class="fa-solid fa-chart-line"></i> Forecasting</a>
  <a href="clustering.html"><i class="fa-solid fa-users-viewfinder"></i> Clustering</a>
  <a href="reports.html"><i class="fa-solid fa-file-lines"></i> Reports</a>
  <a href="feedback.html"><i class="fa-solid fa-bullhorn"></i> Feedback</a>
  <a href="admin-dashboard.html"><i class="fa-solid fa-shield"></i> Admin</a>
  <a href="user-management.html"><i class="fa-solid fa-users"></i> Users</a>
    </nav>
    <div class="header-profile">
      <i class="fa-solid fa-user-circle" id="user-profile-icon" style="cursor: pointer; transition: transform 0.2s;" title="Click to view profile"></i>
    </div>
  </header>

  <script>
    document.getElementById('user-profile-icon').addEventListener('click', function(){
      window.location.href = 'user-profile.html';
    });
  </script>

  <main class="dashboard-container">

    <div class="dashboard-card">
      <h3>Add / Edit Barangay Waste Collection Log</h3>
      <form id="log-form" class="form-grid" autocomplete="off">
        <label>
          Barangay
          <select id="field-barangay">
            <option value="">-- Select Barangay --</option>
            <option>Barangay 1</option>
            <option>Barangay 2</option>
            <option>Barangay 3</option>
          </select>
        </label>

        <label>
          Date
          <input id="field-date" type="date">
        </label>

        <label>
          Waste Type
          <select id="field-type">
            <option value="">-- Select Type --</option>
            <option>General</option>
            <option>Recyclable</option>
            <option>Organic</option>
            <option>Hazardous</option>
          </select>
        </label>

        <label>
          Volume (kg)
          <input id="field-volume" type="number" step="0.1" min="0">
        </label>

        <label>
          Compliance Status
          <select id="field-compliance">
            <option value="">-- Select Status --</option>
            <option>Compliant</option>
            <option>Partial</option>
            <option>Non-compliant</option>
          </select>
        </label>

        <div class="form-actions" style="grid-column: 1 / -1;">
          <button type="button" id="add-btn" class="btn btn-primary">Add Record</button>
          <button type="button" id="update-btn" class="btn" style="display:none;">Update Record</button>
          <button type="reset" id="reset-btn" class="btn">Reset</button>
        </div>
      </form>
    </div>

    <div class="dashboard-card" style="margin-top:16px;">
      <h3>Upload / Import Reports</h3>
      <p class="muted">Upload CSV (Excel XLS/XLSX not parsed in this demo). CSV columns: Barangay,Date,Waste Type,Volume,Compliance</p>
      <input type="file" id="file-input" accept=".csv,.xls,.xlsx">
      <button id="import-btn" class="btn">Import CSV</button>
    </div>

    <div class="dashboard-card" style="margin-top:16px;">
      <h3>Records</h3>

      <div class="table-utilities">
        <div>
          <input id="search-input" placeholder="Search (barangay/type)" />
          <select id="filter-compliance">
            <option value="">All compliance</option>
            <option>Compliant</option>
            <option>Partial</option>
            <option>Non-compliant</option>
          </select>
        </div>

        <div>
          <button id="export-csv" class="btn">Export CSV</button>
          <button id="export-pdf" class="btn">Export PDF</button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="records-table">
          <thead>
            <tr>
              <th>Barangay</th>
              <th>Date</th>
              <th>Waste Type</th>
              <th>Volume (kg)</th>
              <th>Compliance</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </div>

    </div>

  </main>

  <script>
    // Simple client-side wireframe logic: add/edit rows, basic CSV import/export, search & filter
    (function(){
      const form = document.getElementById('log-form');
      const addBtn = document.getElementById('add-btn');
      const updateBtn = document.getElementById('update-btn');
      const resetBtn = document.getElementById('reset-btn');
      const tableBody = document.querySelector('#records-table tbody');
      const searchInput = document.getElementById('search-input');
      const filterCompliance = document.getElementById('filter-compliance');
      const fileInput = document.getElementById('file-input');
      const importBtn = document.getElementById('import-btn');
      const exportCsvBtn = document.getElementById('export-csv');
      const exportPdfBtn = document.getElementById('export-pdf');

      let records = [];
      let editingIndex = -1;

      function renderTable() {
        const q = (searchInput.value || '').toLowerCase();
        const complianceFilter = filterCompliance.value;
        tableBody.innerHTML = '';
        records.forEach((r, i) => {
          if (complianceFilter && r.compliance !== complianceFilter) return;
          if (q) {
            const str = (r.barangay + ' ' + r.type).toLowerCase();
            if (!str.includes(q)) return;
          }
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${escapeHtml(r.barangay)}</td>
            <td>${escapeHtml(r.date)}</td>
            <td>${escapeHtml(r.type)}</td>
            <td>${escapeHtml(r.volume)}</td>
            <td>${escapeHtml(r.compliance)}</td>
            <td>
              <button class="btn btn-small" data-action="edit" data-index="${i}">Edit</button>
              <button class="btn btn-small btn-danger" data-action="delete" data-index="${i}">Delete</button>
            </td>
          `;
          tableBody.appendChild(tr);
        });
      }

      function escapeHtml(s){return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

      function getFormData(){
        return {
          barangay: document.getElementById('field-barangay').value,
          date: document.getElementById('field-date').value,
          type: document.getElementById('field-type').value,
          volume: document.getElementById('field-volume').value,
          compliance: document.getElementById('field-compliance').value
        };
      }

      function setFormData(d){
        document.getElementById('field-barangay').value = d.barangay || '';
        document.getElementById('field-date').value = d.date || '';
        document.getElementById('field-type').value = d.type || '';
        document.getElementById('field-volume').value = d.volume || '';
        document.getElementById('field-compliance').value = d.compliance || '';
      }

      addBtn.addEventListener('click', function(){
        const d = getFormData();
        if(!d.barangay || !d.date){ alert('Please fill Barangay and Date'); return; }
        records.push(d);
        renderTable();
        form.reset();
      });

      tableBody.addEventListener('click', function(e){
        const btn = e.target.closest('button'); if(!btn) return;
        const action = btn.dataset.action; const idx = Number(btn.dataset.index);
        if(action === 'edit'){
          editingIndex = idx;
          setFormData(records[idx]);
          addBtn.style.display='none'; updateBtn.style.display='inline-block';
        } else if(action === 'delete'){
          if(confirm('Delete this record?')){ records.splice(idx,1); renderTable(); }
        }
      });

      updateBtn.addEventListener('click', function(){
        if(editingIndex < 0) return; const d = getFormData();
        records[editingIndex] = d; editingIndex = -1; form.reset(); renderTable();
        addBtn.style.display='inline-block'; updateBtn.style.display='none';
      });

      resetBtn.addEventListener('click', function(){ editingIndex = -1; addBtn.style.display='inline-block'; updateBtn.style.display='none'; });

      searchInput.addEventListener('input', renderTable);
      filterCompliance.addEventListener('change', renderTable);

      importBtn.addEventListener('click', function(){
        const f = fileInput.files[0];
        if(!f){ alert('Choose a CSV file first'); return; }
        if(!f.name.toLowerCase().endsWith('.csv')){
          if(!confirm('Only CSV parsing is supported in this demo. Continue trying?')) return;
        }
        const reader = new FileReader();
        reader.onload = function(){
          const text = reader.result;
          parseCsvText(text);
        };
        reader.readAsText(f);
      });

      function parseCsvText(text){
        const lines = text.split(/\r?\n/).filter(Boolean);
        if(lines.length < 1) return;
        const header = lines[0].split(',').map(h=>h.trim().toLowerCase());
        for(let i=1;i<lines.length;i++){
          const cols = lines[i].split(',').map(c=>c.trim());
          if(cols.length < 5) continue;
          const row = {
            barangay: cols[0],
            date: cols[1],
            type: cols[2],
            volume: cols[3],
            compliance: cols[4]
          };
          records.push(row);
        }
        renderTable();
      }

      exportCsvBtn.addEventListener('click', function(){
        if(records.length === 0){ alert('No records to export'); return; }
        const header = ['Barangay','Date','Waste Type','Volume (kg)','Compliance'];
        const rows = records.map(r => [r.barangay,r.date,r.type,r.volume,r.compliance]);
        const csv = [header].concat(rows).map(r => r.map(cell => '"'+String(cell).replace(/"/g,'""')+'"').join(',')).join('\r\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'waste-records.csv'; document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      exportPdfBtn.addEventListener('click', function(){
        // Simple: open print dialog for the records table area â€” user can choose Save as PDF
        const printWindow = window.open('', '', 'width=900,height=700');
        const style = `
          <style>table{width:100%;border-collapse:collapse}td,th{border:1px solid #ccc;padding:6px;text-align:left}</style>`;
        printWindow.document.write('<html><head><title>Export PDF - Waste Records</title>'+style+'</head><body>');
        printWindow.document.write(document.querySelector('.table-wrap').innerHTML);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        setTimeout(()=>printWindow.print(), 500);
      });

      // seed sample data
      records = [
        {barangay:'Barangay 1', date:'2025-11-01', type:'General', volume:'120.5', compliance:'Compliant'},
        {barangay:'Barangay 2', date:'2025-11-02', type:'Organic', volume:'50.0', compliance:'Partial'}
      ];
      renderTable();

    })();
  </script>

</body>
</html>